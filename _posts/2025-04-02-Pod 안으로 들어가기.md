---
layout: post
category: k8s
---
##  ğŸŒŠ Under the Pod ğŸŒŠ
### 1ï¸âƒ£ Pod ë‚´ë¶€ì—ì„œ kubectl ì‚¬ìš©í•˜ê¸°


#### 1.1 Pod ìƒì„± ë° ì˜¤ë¥˜ í™•ì¸
ë¨¼ì € íŒŒë“œë¥¼ ìƒì„±í•©ë‹ˆë‹¤. í˜„ì¬ ìƒì„±ëœ íŒŒë“œì— ëŒ€í•´ 

ë¨¼ì € ì•„ë˜ ëª…ë ¹ì–´ë¥¼ í†µí•´ kubectl ì´ ì„¤ì¹˜ë˜ì–´ìˆëŠ” ìƒˆë¡œìš´ íŒŒë“œë¥¼ ìƒì„±í•œ í›„ íŒŒë“œì— ì ‘ì†í•©ë‹ˆë‹¤. 

```shell
kubectl run kubectl --image bitnami/kubectl:latest --command -- sleep infinity
kubectl exec -it kubectl -- /bin/bash
```

íŒŒë“œ ë‚´ë¶€ì—ì„œ ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰ì‹œí‚¬ ê²½ìš° ë‹¤ìŒê³¼ ê°™ì€ ì—ëŸ¬ ë©”ì„¸ì§€ë¥¼ í™•ì¸ í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```shell
kubectl get pod
```
![week401](../images/week401.png)

í•´ë‹¹ ì—ëŸ¬ë©”ì„¸ì§€ì˜ ê²½ìš° í•´ë‹¹ íŒŒë“œê°€ ìƒì„±ë˜ì–´ìˆëŠ” Default ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì˜ Default Service Account ë¥¼ ì‚¬ìš©í•˜ë©°, í•´ë‹¹ Service Accountì— Kubectl ëª…ë ¹ì„ í†µí•´ í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ íŒŒë“œë¥¼ ì¡°íšŒí•  ê¶Œí•œì´ ì—†ë‹¤ëŠ” ì˜¤ë¥˜ ì…ë‹ˆë‹¤.

ê·¸ë ‡ê¸°ì— í•´ë‹¹ íŒŒë“œì—ì„œ ì‚¬ìš©ì¤‘ì¸ Default Service Accountì— ì´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê¶Œí•œ
 
#### 1.2 Service Account ìƒì„±

ë¨¼ì € kubectl ì„ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì´ ëª…ì‹œë˜ì–´ìˆëŠ” role ì„ ìƒì„±í•©ë‹ˆë‹¤. ì•„ë˜ yaml íŒŒì¼ì„ ì ìš©í•˜ì—¬, ì´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: kubectl-readonly
  namespace: default
rules:
  - apiGroups: [""]
    resources: ["pods", "services", "configmaps"]
    verbs: ["get", "list", "watch"]
```

ìƒì„±í•œ roleì„ rolebinding ì„ í†µí•´ í˜„ì¬ ìƒì„±ë˜ì–´ìˆëŠ” service account ì— ì ìš© í•´ì¤ë‹ˆë‹¤.

```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: kubectl-readonly-binding
  namespace: default
subjects:
  - kind: ServiceAccount
    name: default
    namespace: default
roleRef:
  kind: Role
  name: kubectl-readonly
  apiGroup: rbac.authorization.k8s.io
```

ì´ë¥¼ ëª¨ë‘ ìƒì„±í•œ í›„ ë‹¤ì‹œ ìƒì„±í•œ íŒŒë“œì— ì ‘ê·¼ í•˜ì—¬ `kubectl get pod` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš© í•˜ë©´ ì •ìƒì ìœ¼ë¡œ í˜„ì¬ ì‚¬ìš©ì¤‘ì¸ í´ëŸ¬ìŠ¤í„°ì˜ íŒŒë“œ ëª©ë¡ì„ ì ‘ê·¼ í•©ë‹ˆë‹¤.

<hr/>


### 2ï¸âƒ£ Pod ë‚´ë¶€ì—ì„œ AWS CLI ì‚¬ìš©í•˜ê¸°

#### 2.1 Pod ìƒì„± ë° ì˜¤ë¥˜ í™•ì¸

ì•„ë˜ ëª…ë ¹ì–´ë¥¼ í†µí•´ AWS CLI ê°€ ì„¤ì¹˜ë˜ì–´ìˆëŠ” íŒŒë“œë¥¼ ìƒì„± í›„ í•´ë‹¹ íŒŒë“œë¡œ /bin/bashë¥¼ ì‚¬ìš©í•˜ì—¬ ì ‘ê·¼í•©ë‹ˆë‹¤.

```bash
kubectl run awscli --image amazon/aws-cli:latest --command -- sleep infinity
kubectl exec -it awscli -- /bin/bash
```

// í˜„ì¬ íŒŒë“œ ë‚´ë¶€ ì ‘ê·¼ í•˜ì˜€ì„ ì‹œ ì´ì „ì— ì‹¤ìŠµ ì‹œ ì ìš©ë˜ì–´ìˆëŠ” aws iam role ì´ ì ìš©ë¨



#### 2.2 IAM Role ìƒì„± ë° Service Account ì—°ê²°
### 3ï¸âƒ£ Pod ë‚´ë¶€ì—ì„œ Cross Account ì‚¬ìš©í•˜ì—¬ íƒ€ ê³„ì •ì˜ ë¦¬ì†ŒìŠ¤ ì ‘ê·¼í•˜ê¸°
### 4ï¸âƒ£ Pod Identity Agent ì‚¬ìš©í•˜ê¸°

